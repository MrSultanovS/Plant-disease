<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Paxta Bargi Kasalligini Aniqlash</title>

<style>
body {
    font-family: Arial;
    text-align: center;
    background: #f4f4f4;
    padding: 40px;
}

.container {
    background: white;
    padding: 30px;
    border-radius: 10px;
    width: 400px;
    margin: auto;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

button {
    background: green;
    color: white;
    border: none;
    padding: 12px;
    width: 100%;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
}

button:hover {
    background: darkgreen;
}

#result {
    margin-top: 15px;
    font-weight: bold;
}
</style>
</head>

<body>

<div class="container">
    <h2>Paxta Bargi Kasalligini Aniqlash</h2>

    <input type="file" id="imageInput" accept="image/*"><br><br>

    <button onclick="classifyImage()">Kasallikni aniqlash</button>

    <div id="result"></div>
</div>

<script>
async function classifyImage() {

    const input = document.getElementById("imageInput");
    const resultDiv = document.getElementById("result");

    if (!input.files.length) {
        resultDiv.innerText = "Iltimos, rasm tanlang.";
        return;
    }

    resultDiv.innerText = "Tekshirilmoqda...";

    const file = input.files[0];

    const reader = new FileReader();

    reader.onloadend = async function () {

        const base64Image = reader.result.split(",")[1];

        try {

            const response = await fetch(
                "https://serverless.roboflow.com/tiu-hwuau/workflows/custom-workflow",
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer mYwLyueNoMAF64OwUV9J"
                    },
                    body: JSON.stringify({
                        inputs: {
                            image: {
                                type: "base64",
                                value: base64Image
                            }
                        }
                    })
                }
            );

            const data = await response.json();
            console.log(data);

            if (data.outputs && data.outputs.length > 0) {

                const prediction = data.outputs[0].predictions[0];

                resultDiv.innerText =
                    "Kasallik: " + prediction.class +
                    " (Aniqlik: " +
                    (prediction.confidence * 100).toFixed(2) +
                    "%)";
            } else {
                resultDiv.innerText = "Natija topilmadi.";
            }

        } catch (error) {
            console.error(error);
            resultDiv.innerText = "Xatolik yuz berdi.";
        }

    };

    reader.readAsDataURL(file);
}
</script>

</body>
</html>
